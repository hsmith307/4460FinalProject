
<!DOCTYPE html>

<head>
  <meta charset="utf-8">
  <title>Pop Song Playlist</title>
</head>

<body>
<script src="https://d3js.org/d3.v4.js"></script>

<h1>Pop Song Playlist Creator</h1>

<div id="chart"></div>

<script>

var margin = {top: 30, right: 10, bottom: 10, left: 0},
    width = document.body.clientWidth - margin.left - margin.right,
    height = 740 - margin.top - margin.bottom;

var svg = d3.select("#chart")
    .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// Parse the Data
d3.csv("songattributes.csv", function(data) {

    var columns = d3.keys(data[0]).splice(5, 10);

    var x = d3.scalePoint()
        .range([0, width])
        .padding(1)
        .domain(columns);

    var y = {}
    for (i in columns) {
        var column = columns[i];
        y[column] = d3.scaleLinear()
            .domain( d3.extent(data, function(d) { return +d[column]; }) )
            .range([height, 0])
    }

    function path(d) {
        return d3.line()(columns.map(function(p) { return [x(p), y[p](d[p])]; }));
    }

    var lines = svg.selectAll("myPath")
        .data(data)
        .enter().append("path")
        .attr("d", path)
        .style("fill", "none")
        .style("stroke", "#2aafe8")
        .style("opacity", 1.00)

    svg.selectAll("myAxis")
        .data(columns).enter()
        .append("g")
        .attr("transform", function(d) { return "translate(" + x(d) + ")"; })
        .each(function(d, i) {
                var brush = d3.brushY()
                    .extent([[-10, 0], [10, height]])
                    .on("start brush end", function() {
                            on_brush(i);
                        });
                d3.select(this)
                    .call(d3.axisLeft().scale(y[d]))
                    .call(brush);
            })
        // Add axis title
        .append("text")
        .style("text-anchor", "middle")
        .attr("y", -9)
        .text(function(d) { return d; })
        .style("fill", "black")

    var selections = [];
    function on_brush(i) {
        var range = d3.event.selection;
        selections[i] = !range || range[0] == range[1] ? null : range;
        var selection = lines;
        selection.style("opacity", 0.05);
        selection.style("stroke", "#d1d1d1")
        // var filtered = false;
        for (i in columns) {
            if (selections[i]) {
                // filtered = true;
                var column = columns[i];
                var brush = selections[i].map(y[column].invert);
                selection = selection.filter(function(d) {
                        var val = d[column];
                        return val >= brush[1] && val <= brush[0];
                    });
            }
        }
        selection.style("opacity", 1.00);
        selection.style("stroke", "#2aafe8")
    }

})

</script>

</body>
